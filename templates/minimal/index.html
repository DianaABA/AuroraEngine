<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aurora Minimal</title>
    <style>
      /* ============================================
         AAA-Class Design System - Aurora Engine
         Accessible, Responsive, Modern
         ============================================ */

      :root{
        /* Typography - System font stack */
        --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', Arial, sans-serif;
        --font-mono: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;

        /* Font sizes - fluid typography */
        --text-xs: clamp(0.75rem, 0.7rem + 0.2vw, 0.875rem);
        --text-sm: clamp(0.875rem, 0.8rem + 0.3vw, 1rem);
        --text-base: clamp(1rem, 0.95rem + 0.25vw, 1.125rem);
        --text-lg: clamp(1.125rem, 1rem + 0.5vw, 1.375rem);
        --text-xl: clamp(1.25rem, 1.1rem + 0.6vw, 1.75rem);
        --text-2xl: clamp(1.5rem, 1.3rem + 0.8vw, 2.25rem);

        /* Spacing system - consistent rhythm */
        --space-1: 0.25rem;
        --space-2: 0.5rem;
        --space-3: 0.75rem;
        --space-4: 1rem;
        --space-5: 1.25rem;
        --space-6: 1.5rem;
        --space-8: 2rem;
        --space-10: 2.5rem;
        --space-12: 3rem;

        /* Colors - AAA contrast compliant */
        --bg-primary: #050814;
        --bg-secondary: #0b1020;
        --bg-tertiary: #0f172a;
        --bg-gradient-start: #0a0f1f;
        --bg-gradient-end: #0e1530;

        /* Text colors - AAA contrast */
        --text-primary: #f1f5f9;
        --text-secondary: #cbd5e1;
        --text-muted: #94a3b8;
        --text-accent: #bfdbfe;

        /* Brand colors - improved contrast */
        --accent-primary: #8b5cf6;
        --accent-primary-hover: #a78bfa;
        --accent-secondary: #22d3ee;
        --accent-secondary-hover: #67e8f9;

        /* UI colors */
        --border-subtle: rgba(255, 255, 255, 0.1);
        --border-default: rgba(255, 255, 255, 0.15);
        --border-strong: rgba(255, 255, 255, 0.2);

        /* Semantic colors - AAA compliant */
        --color-success: #4ade80;
        --color-warning: #fbbf24;
        --color-error: #f87171;
        --color-info: #60a5fa;

        /* Shadows - layered depth */
        --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
        --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.4);
        --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.5);
        --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.6);
        --shadow-glow: 0 0 20px rgba(139, 92, 246, 0.3), 0 0 40px rgba(34, 211, 238, 0.2);

        /* Border radius */
        --radius-sm: 0.375rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --radius-xl: 1rem;
        --radius-full: 9999px;

        /* Transitions */
        --transition-fast: 150ms ease-in-out;
        --transition-base: 250ms ease-in-out;
        --transition-slow: 350ms ease-in-out;

        /* Z-index scale */
        --z-base: 0;
        --z-raised: 10;
        --z-dropdown: 100;
        --z-sticky: 200;
        --z-overlay: 500;
        --z-modal: 1000;
        --z-toast: 2000;
      }
      /* ============================================
         Base Styles & Reset
         ============================================ */

      *, *::before, *::after {
        box-sizing: border-box;
      }

      html {
        height: 100%;
        scroll-behavior: smooth;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      body {
        height: 100%;
        margin: 0;
        font-family: var(--font-family);
        font-size: var(--text-base);
        line-height: 1.6;
        background: var(--bg-primary);
        color: var(--text-primary);
        overflow-y: auto;
      }

      #app {
        height: 100%;
        min-height: 100vh;
      }

      #stage {
        position: relative;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        background:
          radial-gradient(circle at 20% 20%, rgba(139, 92, 246, 0.15), transparent 40%),
          radial-gradient(circle at 80% 0%, rgba(34, 211, 238, 0.15), transparent 45%),
          linear-gradient(180deg, var(--bg-gradient-start), var(--bg-gradient-end));
        overflow: hidden;
        padding: var(--space-4);
      }

      /* Responsive padding */
      @media (min-width: 640px) {
        #stage {
          padding: var(--space-6);
        }
      }
      /* Ensure proper stacking order so UI stays above background */
      #bg{position:absolute;inset:0;z-index:0;pointer-events:none}
      #bg .bg-layer{position:absolute;inset:0;background-size:cover;background-position:center center;filter:brightness(.95);opacity:0;transition:opacity 400ms ease-in-out}
      #bg #bgA{opacity:1}
      #sprites{position:absolute;left:0;right:0;bottom:20%;pointer-events:none;z-index:2}
      #fx{position:absolute;inset:0;pointer-events:none;z-index:3}
      #backdrop{position:absolute;inset:0;background:rgba(0,0,0,.45);backdrop-filter: blur(0.5px);display:none;z-index:4}
      #bgLabel{position:absolute;top:8px;left:8px;z-index:6}
      #content{position:relative;z-index:5}
      #sprites img{position:absolute;bottom:0;max-height:60vh;object-fit:contain;filter:drop-shadow(0 6px 10px rgba(0,0,0,.6));transform:translateX(-50%)}
      #bgLabel{position:absolute;top:8px;left:8px;color:#a8b0ff;font-size:12px;opacity:.8}
      /* ============================================
         Layout Components
         ============================================ */

      #content {
        margin-top: auto;
        background: rgba(11, 16, 32, 0.85);
        backdrop-filter: blur(12px);
        color: var(--text-primary);
        padding: var(--space-6);
        border: 1px solid var(--border-default);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-xl), var(--shadow-glow);
      }

      @media (min-width: 768px) {
        #content {
          padding: var(--space-8);
        }
      }

      #name {
        font-weight: 600;
        font-size: var(--text-lg);
        color: var(--text-accent);
        margin-bottom: var(--space-2);
      }

      #choices {
        display: flex;
        gap: var(--space-3);
        margin-top: var(--space-4);
        flex-wrap: wrap;
      }

      /* ============================================
         Button System - AAA Accessible
         ============================================ */

      button {
        background: var(--accent-primary);
        color: var(--text-primary);
        border: 0;
        padding: var(--space-3) var(--space-5);
        border-radius: var(--radius-md);
        cursor: pointer;
        font-family: var(--font-family);
        font-size: var(--text-sm);
        font-weight: 500;
        line-height: 1.4;
        box-shadow: var(--shadow-md);
        transition:
          transform var(--transition-fast),
          background-color var(--transition-base),
          box-shadow var(--transition-base);
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
        min-height: 44px;
        min-width: 44px;
      }

      button:hover:not(:disabled) {
        background: var(--accent-primary-hover);
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg), var(--shadow-glow);
      }

      button:active:not(:disabled) {
        transform: translateY(0);
      }

      button:focus-visible {
        outline: 3px solid var(--accent-secondary);
        outline-offset: 2px;
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      button.secondary {
        background: var(--bg-tertiary);
        border: 1px solid var(--border-default);
      }

      button.secondary:hover:not(:disabled) {
        background: rgba(30, 41, 59, 0.9);
        border-color: var(--border-strong);
      }

      /* ============================================
         Form Elements - AAA Accessible
         ============================================ */

      select, input, textarea {
        background: var(--bg-secondary);
        border: 1px solid var(--border-default);
        color: var(--text-primary);
        border-radius: var(--radius-md);
        padding: var(--space-3) var(--space-4);
        font-family: var(--font-family);
        font-size: var(--text-sm);
        line-height: 1.5;
        box-shadow: var(--shadow-sm);
        transition:
          border-color var(--transition-base),
          box-shadow var(--transition-base);
        min-height: 44px;
      }

      select:focus, input:focus, textarea:focus {
        outline: none;
        border-color: var(--accent-secondary);
        box-shadow: 0 0 0 3px rgba(34, 211, 238, 0.2);
      }

      textarea {
        resize: vertical;
        min-height: 100px;
      }

      ::placeholder {
        color: var(--text-muted);
        opacity: 1;
      }
      #notifications{position:absolute;right:12px;bottom:12px;display:flex;flex-direction:column;gap:6px;max-width:60vw;}
      /* Error overlay */
      #errorOverlay{position:fixed;inset:0;background:rgba(0,0,0,.78);backdrop-filter:blur(3px);display:none;align-items:center;justify-content:center;z-index:20;}
      #errorCard{background:#0b1020;border:1px solid #4f6bff;border-radius:10px;box-shadow:0 14px 34px rgba(0,0,0,.65);max-width:560px;width:92%;padding:16px;display:flex;flex-direction:column;gap:10px;color:#dbe4ff;}
      #errorCard h3{margin:0;color:#fca5a5;font-size:15px;}
      #errorOverlayBody{max-height:320px;overflow:auto;border:1px solid #27304a;border-radius:8px;padding:10px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-size:12px;background:#0f172a;color:#f8fafc;white-space:pre-wrap;}
      #errorOverlayClose{align-self:flex-end;background:#252a42;color:#bcd4ff;border:1px solid #4f6bff;}
      /* Scene map pan/zoom */
      #branchMapGraph svg{cursor:grab; touch-action: none;}

      /* Transition effects */
      @keyframes fadeOverlay { 0%{background:rgba(0,0,0,0)} 50%{background:rgba(0,0,0,1)} 100%{background:rgba(0,0,0,0)} }
      @keyframes flashOverlay { 0%{background:rgba(255,255,255,0)} 50%{background:rgba(255,255,255,1)} 100%{background:rgba(255,255,255,0)} }
      @keyframes shakeAnim { 0%,100%{ transform:translate(0,0) } 20%{ transform:translate(-4px,2px)} 40%{ transform:translate(3px,-3px)} 60%{ transform:translate(-2px,3px)} 80%{ transform:translate(2px,-2px)} }
      @keyframes zoomAnim { 0%{ transform:scale(1) } 50%{ transform:scale(1.08) } 100%{ transform:scale(1) } }
      .fx-fade{ animation-name:fadeOverlay; animation-duration:300ms; animation-timing-function:ease-in-out }
      .fx-flash{ animation-name:flashOverlay; animation-duration:250ms; animation-timing-function:ease-in-out }
      .fx-shake{ animation-name:shakeAnim; animation-duration:350ms; animation-timing-function:linear }
      .fx-zoom{ animation-name:zoomAnim; animation-duration:350ms; animation-timing-function:ease-in-out }
      /* ============================================
         Comprehensive Responsive System
         Mobile-first approach with proper breakpoints
         ============================================ */

      /* Small mobile devices (0-480px) */
      @media (max-width: 480px) {
        #content {
          padding: var(--space-4);
        }

        #content button {
          width: 100%;
          justify-content: center;
        }

        #content select,
        #content input,
        #content textarea {
          width: 100%;
        }

        #stage {
          padding: var(--space-2);
        }

        #notifications {
          max-width: 95vw;
          right: var(--space-2);
          bottom: var(--space-2);
        }

        .split-title {
          font-size: var(--text-lg);
        }

        .split-desc {
          font-size: var(--text-sm);
        }
      }

      /* Mobile devices (481px-768px) */
      @media (min-width: 481px) and (max-width: 768px) {
        #content > div {
          flex-wrap: wrap;
        }

        #content button {
          min-width: 120px;
        }

        #notifications {
          max-width: 80vw;
        }
      }

      /* Tablet devices (769px-1024px) */
      @media (min-width: 769px) and (max-width: 1024px) {
        #content {
          max-width: 90vw;
          margin-left: auto;
          margin-right: auto;
        }

        #notifications {
          max-width: 60vw;
        }
      }

      /* Desktop (1025px+) */
      @media (min-width: 1025px) {
        #content {
          max-width: 1200px;
          margin-left: auto;
          margin-right: auto;
        }

        #notifications {
          max-width: 400px;
        }
      }

      /* Large desktop (1440px+) */
      @media (min-width: 1440px) {
        #content {
          max-width: 1400px;
        }
      }

      /* Reduce motion for accessibility */
      @media (prefers-reduced-motion: reduce) {
        *, *::before, *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }

        html {
          scroll-behavior: auto;
        }
      }

      /* High contrast mode support */
      @media (prefers-contrast: high) {
        button {
          border: 2px solid currentColor;
        }

        select, input, textarea {
          border-width: 2px;
        }
      }

      /* Dark mode support (already dark, but future-proofing) */
      @media (prefers-color-scheme: light) {
        /* Add light mode variables if needed in future */
      }

      /* Start Splash (Storytellers vs Developers) */
      #startSplash{position:absolute;inset:0;z-index:8;display:none;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(5,8,20,.65), rgba(5,8,20,.85));backdrop-filter: blur(2px)}
      /* Split hero */
      .start-split{position:absolute;inset:0;display:grid;grid-template-columns:1fr 1fr}
      .split-btn{display:flex;flex-direction:column;gap:10px;align-items:flex-start;justify-content:center;padding:24px;border:0;background:transparent;color:var(--text);cursor:pointer;transition:background 200ms ease, transform 200ms ease, box-shadow 200ms ease; position:relative; overflow:hidden}
      .split-btn.left{border-right:1px solid #27304a;background:linear-gradient(90deg, rgba(124,58,237,.08), transparent)}
      .split-btn.right{border-left:1px solid #27304a;background:linear-gradient(270deg, rgba(34,211,238,.10), transparent)}
      .split-btn:hover{background:rgba(11,16,34,.5); transform: translateY(-1px)}
      .split-btn::after{content:""; position:absolute; inset:auto -20% -40% -20%; height:60%; background:radial-gradient(50% 60% at 50% 100%, rgba(124,58,237,.22), rgba(34,211,238,.12) 45%, transparent 65%); filter:blur(20px); opacity:.0; transition:opacity 250ms ease}
      .split-btn:hover::after{opacity:.8}
      .split-title{font-size:22px;font-weight:700;color:#a0e7ff;text-shadow:0 0 10px rgba(124,58,237,.35); transition:color 200ms ease}
      .split-btn.right:hover .split-title{color:#bfefff}
      .split-desc{max-width:520px;color:#a8b0ff;font-size:14px;line-height:1.6}
      .split-pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:#0b1020;border:1px solid #27304a;color:#a8b0ff;font-size:12px}
      .split-docs{display:inline-block;margin-top:6px;color:#93c5fd;font-size:12px;text-decoration:underline}
      .split-docs:hover{color:#bfdbfe}
      @media (max-width: 820px){ .start-split{grid-template-columns:1fr; grid-auto-rows: 1fr} .split-btn.left{border-right:0;border-bottom:1px solid #27304a} .split-btn.right{border-left:0} }

      /* Legacy card layout (kept for future variants) */
      .start-wrap{max-width:980px;width:92%;display:none;grid-template-columns:1fr 1fr;gap:14px}
      .start-card{background:#0b1020;border:1px solid #27304a;border-radius:12px;box-shadow:0 16px 40px rgba(0,0,0,.55);padding:18px;display:flex;flex-direction:column;gap:10px}
      .start-card h2{margin:0;color:#a0e7ff;font-size:18px}
      .start-desc{color:#a8b0ff;font-size:13px;line-height:1.55}
      .start-actions{display:flex;gap:8px;flex-wrap:wrap}
      .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:#0b1020;border:1px solid #27304a;color:#a8b0ff;font-size:12px}
      .muted{opacity:.85}
      @media (max-width: 820px){ .start-wrap{grid-template-columns:1fr} }

      /* Badges + spinner for AI UX */
      .badge{display:inline-flex;align-items:center;gap:6px;padding:2px 8px;border-radius:999px;border:1px solid #27304a;background:#0b1020;font-size:11px;color:#a8b0ff}
      .badge.warn{border-color:#eab308;color:#fde68a;background:#3a2f0a}
      .badge.error{border-color:#f87171;color:#fecaca;background:#3b0a0a}
      .spinner{width:12px;height:12px;border:2px solid rgba(160,231,255,.25);border-top-color:#a0e7ff;border-radius:50%;animation:spin 0.9s linear infinite}
      @keyframes spin{to{transform:rotate(360deg)}}

      /* Assistant chat */
      #assistantOverlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:30;background:rgba(0,0,0,.55);backdrop-filter:blur(2px)}
      #assistantPanel{max-width:720px;width:92%;background:#0b1020;border:1px solid #27304a;border-radius:10px;box-shadow:0 18px 44px rgba(0,0,0,.6);display:flex;flex-direction:column;max-height:80vh}
      #assistantHeader{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid #27304a}
      #assistantHeader strong{color:#a0e7ff}
      #assistantBody{padding:10px 12px;overflow:auto;display:flex;flex-direction:column;gap:8px}
      .asst-msg{padding:8px 10px;border:1px solid #27304a;border-radius:8px;font-size:12px;white-space:pre-wrap}
      .asst-user{background:#111827;color:#a8b0ff;align-self:flex-end}
      .asst-bot{background:#0f172a;color:#a0e7ff;align-self:flex-start}
      #assistantFooter{display:flex;gap:8px;align-items:center;padding:10px 12px;border-top:1px solid #27304a}
      #assistantInput{flex:1;min-width:160px;padding:8px;border-radius:8px;border:1px solid #27304a;background:#0b1020;color:#a8b0ff}
      #assistantSend{min-width:92px}
      /* Presets toolbar styling */
      #assistantPresets{padding:8px 12px;border-top:1px dashed #27304a;border-bottom:1px dashed #27304a;background:#0b1020;border-radius:8px;margin:8px 12px}
      .preset-btn{font-size:11px;padding:6px 10px;min-height:auto}
      .preset-btn:hover{box-shadow:var(--shadow-md)}
    </style>
  </head>
  <body>
    <div id="app">
      <div id="stage">
        <div style="position:absolute; top:8px; right:8px; z-index:9; display:flex; gap:6px; align-items:center;">
          <a href="https://github.com/DianaABA/AuroraEngine#readme" target="_blank" rel="noreferrer noopener" style="color:#93c5fd; font-size:12px; text-decoration:underline" title="Open Docs (new tab)">Docs ↗</a>
          <a href="https://github.com/DianaABA/AuroraEngine/tree/main/docs/assistant-guides" target="_blank" rel="noreferrer noopener" style="color:#93c5fd; font-size:12px; text-decoration:underline" title="Open Assistant Guides (new tab)">Assistant Guides ↗</a>
          <a href="https://www.youtube.com/@BugQueenFlow" target="_blank" rel="noreferrer noopener" style="color:#93c5fd; font-size:12px; text-decoration:underline" title="YouTube — BugQueen Flow (general channel)">YouTube ↗</a>
          <button id="openStartSplash" class="secondary" title="Choose Storyteller or Developer">Mode</button>
        </div>
        <div id="startSplash" role="dialog" aria-modal="true">
          <!-- Split hero UX: left = storytellers, right = developers -->
          <div class="start-split" aria-label="Choose how to start using Aurora">
            <button id="splitLeft" class="split-btn left">
              <span class="split-pill">For Storytellers</span>
              <div class="split-title">Play & Explore</div>
              <div class="split-desc">Jump into the demo, make choices, switch packs — no setup needed. For quick help, see <a class="split-docs" href="https://github.com/DianaABA/AuroraEngine/tree/main/docs/assistant-guides" target="_blank" rel="noreferrer noopener" onclick="event.stopPropagation()">Assistant Guides ↗</a>. Click anywhere on the left to start.</div>
            </button>
            <div id="splitRight" class="split-btn right" role="button" tabindex="0">
              <span class="split-pill">For Developers</span>
              <div class="split-title">Build & Edit</div>
              <div class="split-desc">Open the lightweight editor, validate scenes, view the branch map, and use advanced tools. For step‑by‑step tasks, see <a class="split-docs" href="https://github.com/DianaABA/AuroraEngine/tree/main/docs/assistant-guides" target="_blank" rel="noreferrer noopener" onclick="event.stopPropagation()">Assistant Guides ↗</a>. Click anywhere on the right to start.</div>
              <a class="split-docs" href="https://github.com/DianaABA/AuroraEngine#readme" target="_blank" rel="noreferrer noopener" title="Open Docs (new tab)" onclick="event.stopPropagation()">Docs ↗</a>
            </div>
          </div>
        </div>
        <div id="bg">
          <div id="bgA" class="bg-layer"></div>
          <div id="bgB" class="bg-layer"></div>
        </div>
        <div id="fx"></div>
        <div id="backdrop" aria-hidden="true"></div>
        <div id="sprites"></div>
        <div id="bgLabel"></div>
        <div id="debugHud" style="position:absolute; top:8px; right:8px; z-index:6; background:rgba(0,0,0,.6); border:1px solid #27304a; border-radius:6px; padding:6px 8px; color:#a8b0ff; font-size:12px; display:none"></div>
        <div id="content">
          <div id="achPanel" style="display:none; padding:12px; background:rgba(0,0,0,.7); border-radius:8px; margin-bottom:8px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
              <strong style="color:#a0e7ff">Achievements</strong>
              <button id="closeAch" class="secondary">Close</button>
            </div>
            <div id="achList" style="display:flex; flex-direction:column; gap:6px;"></div>
          </div>
          <div id="galleryPanel" style="display:none; padding:12px; background:rgba(0,0,0,.7); border-radius:8px; margin-bottom:8px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
              <strong style="color:#a0e7ff">Gallery</strong>
              <button id="closeGallery" class="secondary">Close</button>
            </div>
            <div id="galleryGrid" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap:8px;"></div>
          </div>
          <div id="codexPanel" style="display:none; padding:12px; background:rgba(0,0,0,.7); border-radius:8px; margin-bottom:8px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
              <strong style="color:#a0e7ff">Codex</strong>
              <button id="closeCodex" class="secondary">Close</button>
            </div>
            <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px; flex-wrap:wrap">
              <input id="codexSearch" placeholder="Search..." style="flex:1; min-width:220px; padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff" />
              <select id="codexCategory" style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff">
                <option value="">All Categories</option>
              </select>
            </div>
            <div id="codexFilters" style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px"></div>
            <div id="codexList" style="display:flex; flex-direction:column; gap:6px;"></div>
            <div id="codexDetail" style="display:none; margin-top:8px; padding:10px; background:#0b1020; border:1px solid #27304a; border-radius:8px;">
              <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px;">
                <strong id="codexDetailTitle" style="color:#a0e7ff">Title</strong>
                <div style="display:flex; gap:8px; align-items:center;">
                  <button id="codexPinBtn" class="secondary" title="Pin/unpin">Pin</button>
                  <button id="codexFavBtn" class="secondary" title="Favorite/unfavorite">Favorite</button>
                  <button id="codexDetailClose" class="secondary">Close</button>
                </div>
              </div>
              <div id="codexDetailBody" style="color:#a8b0ff; font-size:13px; white-space:pre-wrap"></div>
            </div>
          </div>
          <div id="backlogPanel" style="display:none; padding:12px; background:rgba(0,0,0,.7); border-radius:8px; margin-bottom:8px; max-height:240px; overflow:auto;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
              <strong style="color:#a0e7ff">Backlog</strong>
              <button id="closeBacklog" class="secondary">Close</button>
            </div>
            <div id="backlogList" style="display:flex; flex-direction:column; gap:6px;"></div>
          </div>
          <div id="settingsPanel" style="display:none; padding:12px; background:rgba(0,0,0,.7); border-radius:8px; margin-bottom:8px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
              <strong style="color:#a0e7ff" id="settingsTitle">Settings</strong>
              <button id="closeSettings" class="secondary">Close</button>
            </div>
            <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
              <button id="toggleSkipSeen" class="secondary">Skip Seen Text: Off</button>
              <button id="toggleSkipTransitions" class="secondary">Skip Transitions: Off</button>
              <button id="toggleHotkeys" class="secondary">Hotkeys: On</button>
              <button id="toggleTheme" class="secondary">Theme: Night</button>
              <button id="clearSeen" class="secondary">Clear Seen</button>
              <span style="font-size:12px; color:#a8b0ff">Skips dialogue lines you have already seen.</span>
            </div>
            <div style="margin-top:8px; display:flex; gap:8px; align-items:center; flex-wrap:wrap">
              <strong style="color:#a0e7ff; font-size:12px">AI Mode</strong>
              <select id="aiModeSelect" style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff">
                <option value="local">Local (offline)</option>
                <option value="byok">BYOK (API key)</option>
              </select>
              <select id="aiProvider" style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff">
                <option value="openai" data-model="gpt-4o-mini" data-base="">OpenAI-compatible</option>
                <option value="anthropic" data-model="claude-3-haiku-20240307" data-base="https://api.anthropic.com/v1">Anthropic (Claude)</option>
                <option value="groq" data-model="llama-3.1-70b-versatile" data-base="https://api.groq.com/openai/v1">Groq</option>
                <option value="deepseek" data-model="deepseek-chat" data-base="https://api.deepseek.com/v1">DeepSeek</option>
              </select>
              <input id="aiModel" placeholder="Model (e.g., gpt-4o-mini)" style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff; min-width:160px" />
              <input id="aiBaseUrl" placeholder="Base URL (optional)" style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff; min-width:180px" />
              <input id="aiLocalModel" placeholder="Local model id (e.g., Qwen2-0.5B)" style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff; min-width:200px" />
              <input id="aiApiKey" placeholder="API key (stored locally)" style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff; min-width:220px" />
              <span style="font-size:12px; color:#a8b0ff">Keys stay in your browser; local mode uses offline models.</span>
            </div>
            <div style="margin-top:8px; display:flex; gap:12px; align-items:center; flex-wrap:wrap">
              <div style="display:flex; gap:6px; align-items:center">
                <label for="bgFadeMs" style="font-size:12px; color:#a8b0ff">BG Fade</label>
                <input id="bgFadeMs" type="range" min="0" max="1500" step="50" value="400" style="width:160px; accent-color:#3e59ff" />
                <span id="bgFadeMsVal" style="font-size:12px; color:#a8b0ff">400ms</span>
              </div>
              <div style="display:flex; gap:6px; align-items:center">
                <label for="spriteFadeMs" style="font-size:12px; color:#a8b0ff">Sprite Fade</label>
                <input id="spriteFadeMs" type="range" min="0" max="1500" step="50" value="220" style="width:160px; accent-color:#3e59ff" />
                <span id="spriteFadeMsVal" style="font-size:12px; color:#a8b0ff">220ms</span>
              </div>
            </div>
            <div style="margin-top:8px; display:flex; gap:8px; align-items:center; flex-wrap:wrap">
              <strong style="color:#a0e7ff; font-size:12px" id="langLabel">Language</strong>
              <button id="langEn" class="secondary">English</button>
              <button id="langEs" class="secondary">Spanish</button>
              <button id="langAr" class="secondary">Arabic</button>
            </div>
          </div>
          <div id="line"><span id="name"></span><span id="text"></span></div>
          <div id="choices"></div>
          <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap">
            <button id="continueBtn">Continue</button>
            <button id="startExample">Start Example</button>
            <button id="startExpressions">Start Expressions</button>
            <button id="startAch">Start Achievements</button>
            <span style="color:#a8b0ff; font-size:12px;">Pick a pack, then load it:</span>
            <select id="packSelect" style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff;">
              <option value="example">Example — branching basics</option>
              <option value="expressions">Expressions — sprites + CG unlock</option>
              <option value="achievements">Achievements — badge unlock path</option>
              <option value="rtl">RTL/TextId — Arabic + textId table</option>
              <option value="byok">BYOK — API key demo</option>
            </select>
            <button id="loadPack" class="secondary">Load Pack</button>
            <button id="viewPackJson" class="secondary" title="View pack JSON (read-only)">View JSON</button>
            <span id="packDesc" style="color:#a8b0ff; font-size:12px;">Example — branching basics</span>
            <button id="askAurora" class="secondary" title="AI helper (How do I…?)">Ask Aurora</button>
            <button id="autoBtn" class="secondary">Auto: Off</button>
            <button id="autoChooseBtn" class="secondary">Auto-Choose: Off</button>
            <button id="skipFx" class="secondary">Skip FX: Off</button>
            <button id="openGallery" class="secondary">Gallery</button>
            <button id="openAch" class="secondary">Achievements</button>
            <button id="openCodex" class="secondary">Codex</button>
            <button id="openSettings" class="secondary">Settings</button>
            <button id="openBacklog" class="secondary">Backlog</button>
            <button id="openSaves" class="secondary">Saves</button>
            <button id="openShortcuts" class="secondary">Shortcuts (?)</button>
            <button id="undoBtn" class="secondary" title="Undo last choice if possible">Undo</button>
            <button id="escapeBtn" class="secondary" title="Hide panels/escape">Escape</button>
            <button id="nextBtn" class="secondary">Next</button>
            <button id="saveBtn">Quick Save</button>
            <button id="loadBtn" class="secondary">Quick Load</button>
            <span id="saveStatus" style="font-size:12px; color:#a8b0ff"></span>
          </div>
          <div id="shortcutHint" style="margin-top:6px; font-size:12px; color:#a8b0ff; opacity:.85">
            Tip: Press <strong>?</strong> for shortcuts — Space/Enter: Next, A: Auto, Ctrl+S: Save
          </div>
          <div style="margin-top:8px; display:flex; gap:8px; align-items:center; flex-wrap:wrap">
            <strong style="color:#a0e7ff; font-size:12px">Music:</strong>
            <button class="secondary" id="musicPlay">Play</button>
            <button class="secondary" id="musicPause">Pause</button>
            <span id="musicStatus" style="font-size:12px; color:#a8b0ff"></span>
            <input id="volumeSlider" type="range" min="0" max="100" step="1" value="80" title="Volume" style="width:140px; accent-color:#3e59ff" />
            <button class="secondary" id="muteToggle" title="Mute/unmute">Mute</button>
          </div>
          <div style="margin-top:8px; display:flex; gap:8px; align-items:center; flex-wrap:wrap">
            <strong style="color:#a0e7ff; font-size:12px">Slots:</strong>
            <button class="secondary" id="slot1save">Save 1</button>
            <button class="secondary" id="slot1load">Load 1</button>
            <img id="slot1thumb" alt="" style="width:96px; height:54px; object-fit:cover; border-radius:4px; border:1px solid #27304a" />
            <button class="secondary" id="slot2save">Save 2</button>
            <button class="secondary" id="slot2load">Load 2</button>
            <img id="slot2thumb" alt="" style="width:96px; height:54px; object-fit:cover; border-radius:4px; border:1px solid #27304a" />
            <button class="secondary" id="slot3save">Save 3</button>
            <button class="secondary" id="slot3load">Load 3</button>
            <img id="slot3thumb" alt="" style="width:96px; height:54px; object-fit:cover; border-radius:4px; border:1px solid #27304a" />
            <span id="slotStatus" style="font-size:12px; color:#a8b0ff"></span>
          </div>
          <div style="margin-top:8px;">
            <button id="toggleAdvanced" class="secondary" aria-expanded="false">Advanced ▸</button>
            <div id="advancedPanel" style="display:none; margin-top:8px; padding:12px; background:rgba(0,0,0,.65); border:1px dashed #27304a; border-radius:8px;">
              <div id="assetPanel">
                <div style="display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap;">
                  <strong style="color:#a0e7ff; font-size:13px">Drag & Drop Assets</strong>
                  <button id="assetPick" class="secondary">Pick Files</button>
                </div>
                <div id="assetDrop" style="margin-top:6px; padding:10px; border:1px dashed #27304a; border-radius:8px; color:#a8b0ff; font-size:12px; text-align:center; background:#0b1020;">
                  Drop images or music here to preview. Files stay in your browser (local only).
                </div>
                <div id="assetList" style="margin-top:8px; display:flex; flex-direction:column; gap:6px;"></div>
              </div>
            </div>
          </div>
          <div id="sceneLoader" style="margin-top:8px; padding:12px; background:rgba(0,0,0,.65); border-radius:8px; border:1px solid #27304a;">
            <div style="display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap;">
              <strong style="color:#a0e7ff; font-size:13px">Load Story File (paste JSON)</strong>
              <input id="customStartId" placeholder="Start story part (optional)" style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff; min-width:160px" />
              <button id="customFileBtn" class="secondary">Pick File</button>
              <button id="customLoadBtn">Start Story</button>
              <button id="customLint" class="secondary">Check Story</button>
              <button id="customFix" class="secondary">Try Fix</button>
            </div>
            <div style="margin-top:6px; display:flex; gap:8px; align-items:center; flex-wrap:wrap">
              <input id="aiPrompt" placeholder="AI prompt (scene idea or script)" style="flex:1; min-width:260px; padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff" />
                <button id="aiGenerateBtn" class="secondary" title="Generate scene JSON from prompt">AI: Generate</button>
                <button id="aiGenerateToEditorBtn" class="secondary" title="Generate and load into editor">AI → Editor</button>
                <button id="aiFixBtn" class="secondary" title="Fix grammar/typos">AI: Fix Grammar</button>
                <button id="aiCancel" class="secondary" title="Cancel current AI request">Cancel AI</button>
                <button id="aiPresetBranch" class="secondary" title="Adds branching choices to the current scene">Preset: Branch</button>
                <button id="aiPresetCoach" class="secondary" title="Story coach: pacing & beat suggestions">Preset: Coach</button>
                <span id="aiStatus" class="badge" style="display:none"></span>
                <span id="aiError" class="badge error" style="display:none"></span>
                <span id="aiRateHint" class="badge warn" style="display:none"></span>
              </div>
            <div id="aiProgress" style="display:none; width:100%; height:4px; background:#1e293b; border-radius:4px; overflow:hidden;">
              <div id="aiProgressBar" style="width:0%; height:100%; background:#3e59ff; transition:width 250ms ease"></div>
            </div>
            <textarea id="customJson" style="margin-top:6px; width:100%; min-height:140px; background:#0b1020; color:#a8b0ff; border:1px solid #27304a; border-radius:8px; padding:8px; font-family:monospace; font-size:12px;"></textarea>
            <div id="customErrors" style="margin-top:6px; color:#a0e7ff; font-size:12px; white-space:pre-wrap"></div>
          </div>
          <div id="sceneEditor" style="margin-top:8px; padding:12px; background:rgba(0,0,0,.65); border-radius:8px; border:1px solid #27304a;">
            <div style="display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap;">
              <strong style="color:#a0e7ff; font-size:13px">Story Editor</strong>
              <div style="display:flex; flex-direction:column; gap:4px;">
                <input id="editorSceneId" placeholder="scene id" style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff; min-width:120px" />
                <small style="color:#8892b0; font-size:11px">Required. Used by goto/choice targets.</small>
              </div>
              <div style="display:flex; flex-direction:column; gap:4px;">
                <input id="editorBg" placeholder="background (optional)" style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff; min-width:140px" />
                <small style="color:#8892b0; font-size:11px">E.g. lab.svg — also sets thumbnail.</small>
              </div>
              <div style="display:flex; flex-direction:column; gap:4px;">
                <input id="editorMusic" placeholder="music (optional)" style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff; min-width:140px" />
                <small style="color:#8892b0; font-size:11px">Track name from your assets (jukebox).</small>
              </div>
              <div style="display:flex; flex-direction:column; gap:4px;">
                <input id="editorSceneRoles" placeholder='roles (JSON e.g. {"guide":"spr_guide"})' style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff; min-width:200px" />
                <small style="color:#8892b0; font-size:11px">Map character ids → sprite ids once; reused in steps.</small>
              </div>
              <input id="editorBundleIds" placeholder="bundle (comma ids)" style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff; min-width:180px" />
              <div id="editorTabs" style="display:flex; gap:6px; flex-wrap:wrap;"></div>
              <button id="editorNewScene" class="secondary">+ Scene</button>
              <button id="editorSave" class="secondary" title="Save editor state to localStorage">Save</button>
              <button id="editorLoadSaved" class="secondary" title="Load saved editor state">Load</button>
            </div>
            <div style="margin-top:8px; display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:8px; align-items:flex-start;">
              <div>
                <label style="color:#a8b0ff; font-size:12px">Step Type</label>
                <select id="editorStepType" style="width:100%; padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff">
                  <option value="dialogue">dialogue</option>
                  <option value="choice">choice</option>
                  <option value="background">background</option>
                  <option value="spriteShow">spriteShow</option>
                  <option value="spriteSwap">spriteSwap</option>
                  <option value="music">music</option>
                  <option value="flag">flag</option>
                  <option value="transition">transition</option>
                </select>
              </div>
              <div>
                <label style="color:#a8b0ff; font-size:12px">Who / Sprite / Flag</label>
                <input id="editorChar" placeholder="character or sprite id / flag key" style="width:100%; padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff" />
              </div>
              <div>
                <label style="color:#a8b0ff; font-size:12px">Text / Image / Music</label>
                <input id="editorText" placeholder="dialogue text, sprite src, audio track" style="width:100%; padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff" />
              </div>
              <div>
                <label style="color:#a8b0ff; font-size:12px">Move (x,y,ms,ease)</label>
                <input id="editorMove" placeholder="e.g. x=40,y=-10,ms=400" style="width:100%; padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff" />
              </div>
              <div>
                <label style="color:#a8b0ff; font-size:12px">Choice options (label|goto per line)</label>
                <textarea id="editorOptions" style="width:100%; min-height:80px; padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff; font-size:12px"></textarea>
              </div>
            </div>
            <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;">
              <button id="editorAddStep" class="secondary">Add Step</button>
              <button id="editorReset" class="secondary">Reset</button>
              <button id="editorStarter" class="secondary" title="Load sample dialogue + choice">Load Starter</button>
              <button id="editorLoad" class="" title="Validate and load scenes into the engine">Build & Run</button>
              <button id="editorLintRun" class="secondary" title="Quick lint; run on pass">Lint & Run</button>
              <button id="editorDownload" class="secondary">Download JSON</button>
              <button id="editorImport" class="secondary">Import JSON</button>
              <button id="editorAskAurora" class="secondary" title="Open Ask Aurora with current scene and errors">Ask Aurora (Context)</button>
              <span id="editorLintStatus" style="font-size:12px; color:#a8b0ff;">Lint: pending</span>
              <span id="editorLive" style="font-size:12px; color:#fca5a5;"></span>
              <span id="editorMeta" style="font-size:12px; color:#a8b0ff;">Active: —</span>
              <span id="editorSavedAt" style="font-size:12px; color:#a0e7ff;">Saved: —</span>
            </div>
            <div id="editorStepsHint" style="margin-top:4px; color:#8aa0e0; font-size:11px;">Tip: Drag ⋮⋮ or use Alt+Arrow to reorder steps.</div>
            <div id="editorSteps" style="margin-top:6px; display:flex; flex-direction:column; gap:6px; color:#a8b0ff; font-size:12px;"></div>
            <pre id="editorPreview" style="margin-top:8px; background:#0b1020; color:#a0e7ff; border:1px solid #27304a; border-radius:8px; padding:8px; font-size:12px; max-height:180px; overflow:auto;"></pre>
            <div id="editorErrors" style="margin-top:6px; color:#ffb4b4; font-size:12px; white-space:pre-wrap"></div>
            <div id="branchMap" style="margin-top:8px; padding:10px; background:#0b1020; border:1px solid #27304a; border-radius:8px; color:#a8b0ff; font-size:12px;">
              <strong style="color:#a0e7ff;">Branch map (scenes & goto targets)</strong>
              <div id="branchMapBody" style="margin-top:6px; display:flex; flex-direction:column; gap:6px;"></div>
              <div id="branchMapGraph" style="margin-top:8px; background:#0b1020; border:1px solid #27304a; border-radius:8px; padding:6px;"></div>
            </div>
          </div>
          <div id="aiPanel" style="margin-top:8px; padding:12px; background:rgba(0,0,0,.65); border-radius:8px; border:1px solid #27304a;">
            <div style="display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap;">
              <strong style="color:#a0e7ff; font-size:13px">Authoring AI Helpers</strong>
              <span style="font-size:12px; color:#a8b0ff">Local tools (offline) & BYOK (JSON responses)</span>
            </div>
            <div style="margin-top:8px; display:grid; grid-template-columns: repeat(auto-fit,minmax(240px,1fr)); gap:8px;">
              <div style="display:flex; flex-direction:column; gap:6px;">
                <label for="aiScript" style="color:#a8b0ff; font-size:12px">Script to Story JSON (local)</label>
                <textarea id="aiScript" style="min-height:100px; background:#0b1020; color:#a8b0ff; border:1px solid #27304a; border-radius:6px; padding:8px; font-size:12px"></textarea>
                <button id="aiConvert" class="secondary">Convert Script ➜ JSON</button>
                <button id="aiFixGrammar" class="secondary">Fix Grammar (local)</button>
                <button id="aiDetectErrors" class="secondary">Detect Scene Errors (local)</button>
              </div>
              <div style="display:flex; flex-direction:column; gap:6px;">
                <label for="aiPrompt" style="color:#a8b0ff; font-size:12px">Prompt ➜ Scene JSON (BYOK)</label>
                <textarea id="aiPrompt" style="min-height:100px; background:#0b1020; color:#a8b0ff; border:1px solid #27304a; border-radius:6px; padding:8px; font-size:12px"></textarea>
                <button id="aiGenerateScene" class="secondary">Generate Scene (remote)</button>
                <button id="aiExtendDialogue" class="secondary">Extend Current Scene (remote)</button>
                <button id="aiSuggestBranches" class="secondary">Suggest Branches (remote)</button>
              </div>
              <div style="display:flex; flex-direction:column; gap:6px;">
                <label for="aiOutput" style="color:#a8b0ff; font-size:12px">AI Output / JSON</label>
                <textarea id="aiOutput" style="min-height:180px; background:#0b1020; color:#a0e7ff; border:1px solid #27304a; border-radius:6px; padding:8px; font-size:12px; white-space:pre"></textarea>
                <button id="aiLoadOutput" class="secondary" title="Load JSON from output into engine">Load Output JSON</button>
              </div>
            </div>
            <div id="aiStatus" style="margin-top:6px; font-size:12px; color:#a8b0ff"></div>
          </div>
          <div id="savesPanel" style="display:none; padding:12px; background:rgba(0,0,0,.7); border-radius:8px; margin:12px 0;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
              <strong style="color:#a0e7ff">Saves</strong>
              <button id="closeSaves" class="secondary">Close</button>
            </div>
            <div id="savesList" style="display:flex; flex-direction:column; gap:8px;"></div>
          </div>
        </div>
        <!-- First-run onboarding modal -->
        <div id="onboarding" style="display:none; position:absolute; inset:0; z-index:7; display:none; align-items:center; justify-content:center;">
          <div style="max-width:560px; width:92%; background:#0b1020; border:1px solid #27304a; border-radius:10px; padding:14px; color:#a8b0ff; box-shadow:0 20px 40px rgba(0,0,0,.6)">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
              <strong style="color:#a0e7ff">Welcome to Aurora Minimal</strong>
              <button id="onbDismiss" class="secondary">Close</button>
            </div>
            <div style="font-size:13px; margin-bottom:10px; line-height:1.5">
              Get started quickly:
              <ul style="margin:6px 0 0 16px; padding:0">
                <li>Press <strong>Start Example</strong> to load a sample scene.</li>
                <li>Press <strong>?</strong> or <strong>Shortcuts</strong> to see hotkeys.</li>
                <li>Tap/click the scene to advance; use choices to branch.</li>
              </ul>
            </div>
            <div style="display:flex; gap:8px; flex-wrap:wrap">
              <button id="onbStart" class="secondary">Start Example</button>
              <button id="onbShortcuts" class="secondary">Shortcuts</button>
              <button id="onbSettings" class="secondary">Settings</button>
            </div>
          </div>
        </div>
      </div>
      <div id="notifications" aria-live="polite"></div>
    </div>
    <div id="errorOverlay" role="alertdialog" aria-modal="true">
      <div id="errorCard">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
          <h3 style="margin:0">Validation / Load Error</h3>
          <button id="errorOverlayClose" class="secondary">Close</button>
        </div>
        <p id="errorOverlayHint" style="margin:0; color:#cbd5ff; font-size:12px">
          The scene data didn’t validate. Fix the issues below, then reload.
        </p>
        <div id="errorOverlayBody"></div>
        <div style="display:flex; gap:8px; flex-wrap:wrap">
          <button id="errorCopy" class="secondary">Copy errors</button>
              <button id="errorAskAurora" class="secondary" title="Open Ask Aurora with these errors">Ask Aurora about errors</button>
        </div>
      </div>
    </div>
    <!-- Assistant chat overlay -->
    <div id="assistantOverlay" role="dialog" aria-modal="true">
      <div id="assistantPanel">
        <div id="assistantHeader">
          <strong>Ask Aurora</strong>
          <div style="display:flex;gap:8px;align-items:center;">
            <span id="assistantProvider" class="badge" title="Current provider" style="display:inline-flex"></span>
            <span id="assistantModel" class="badge" title="Current model" style="display:inline-flex"></span>
            <span id="assistantTokens" class="badge" title="Estimated tokens" style="display:none"></span>
            <span id="assistantStatus" class="badge" style="display:none"></span>
            <button id="assistantClose" class="secondary">Close</button>
          </div>
        </div>
        <div id="assistantBody" aria-live="polite"></div>
        <div id="assistantFooter">
          <input id="assistantInput" placeholder="Ask about scenes, packs, errors…" />
          <button id="assistantSend">Send</button>
          <button id="assistantStop" class="secondary" title="Cancel current request">Stop</button>
          <button id="assistantCopy" class="secondary" title="Copy last answer">Copy</button>
          <button id="assistantClear" class="secondary" title="Clear chat history">Clear</button>
        </div>
      </div>
    </div>
    <script type="module" src="/src/main.ts"></script>
    <script type="module" src="/src/assistant.ts"></script>
  </body>
</html>

