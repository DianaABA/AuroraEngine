<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Aurora Minimal</title>
    <style>
      html,body,#app{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial}
      #stage{position:relative;display:flex;flex-direction:column;height:100%;background:linear-gradient(180deg,#151a2d,#28314a);overflow:hidden}
      /* Ensure proper stacking order so UI stays above background */
      #bg{position:absolute;inset:0;z-index:0;pointer-events:none}
      #bg .bg-layer{position:absolute;inset:0;background-size:cover;background-position:center center;filter:brightness(.95);opacity:0;transition:opacity 400ms ease-in-out}
      #bg #bgA{opacity:1}
      #sprites{position:absolute;left:0;right:0;bottom:20%;pointer-events:none;z-index:2}
      #fx{position:absolute;inset:0;pointer-events:none;z-index:3}
      #backdrop{position:absolute;inset:0;background:rgba(0,0,0,.45);backdrop-filter: blur(0.5px);display:none;z-index:4}
      #bgLabel{position:absolute;top:8px;left:8px;z-index:6}
      #content{position:relative;z-index:5}
      #sprites img{position:absolute;bottom:0;max-height:60vh;object-fit:contain;filter:drop-shadow(0 6px 10px rgba(0,0,0,.6));transform:translateX(-50%)}
      #bgLabel{position:absolute;top:8px;left:8px;color:#a8b0ff;font-size:12px;opacity:.8}
      #content{margin-top:auto;background:rgba(0,0,0,.5);color:#fff;padding:16px}
      #name{font-weight:600;color:#a0e7ff}
      #choices{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
      button{background:#3e59ff;color:#fff;border:0;padding:8px 12px;border-radius:6px;cursor:pointer}
      button:focus-visible{outline:2px solid #a0e7ff; outline-offset:2px}
      button.secondary{background:#2b2f43}
      #notifications{position:absolute;right:12px;bottom:12px;display:flex;flex-direction:column;gap:6px;max-width:60vw;}

      /* Transition effects */
      @keyframes fadeOverlay { 0%{background:rgba(0,0,0,0)} 50%{background:rgba(0,0,0,1)} 100%{background:rgba(0,0,0,0)} }
      @keyframes flashOverlay { 0%{background:rgba(255,255,255,0)} 50%{background:rgba(255,255,255,1)} 100%{background:rgba(255,255,255,0)} }
      @keyframes shakeAnim { 0%,100%{ transform:translate(0,0) } 20%{ transform:translate(-4px,2px)} 40%{ transform:translate(3px,-3px)} 60%{ transform:translate(-2px,3px)} 80%{ transform:translate(2px,-2px)} }
      @keyframes zoomAnim { 0%{ transform:scale(1) } 50%{ transform:scale(1.08) } 100%{ transform:scale(1) } }
      .fx-fade{ animation-name:fadeOverlay; animation-duration:300ms; animation-timing-function:ease-in-out }
      .fx-flash{ animation-name:flashOverlay; animation-duration:250ms; animation-timing-function:ease-in-out }
      .fx-shake{ animation-name:shakeAnim; animation-duration:350ms; animation-timing-function:linear }
      .fx-zoom{ animation-name:zoomAnim; animation-duration:350ms; animation-timing-function:ease-in-out }
    </style>
  </head>
  <body>
    <div id="app">
      <div id="stage">
        <div id="bg">
          <div id="bgA" class="bg-layer"></div>
          <div id="bgB" class="bg-layer"></div>
        </div>
        <div id="fx"></div>
        <div id="backdrop" aria-hidden="true"></div>
        <div id="sprites"></div>
        <div id="bgLabel"></div>
        <div id="debugHud" style="position:absolute; top:8px; right:8px; z-index:6; background:rgba(0,0,0,.6); border:1px solid #27304a; border-radius:6px; padding:6px 8px; color:#a8b0ff; font-size:12px; display:none"></div>
        <div id="content">
          <div id="achPanel" style="display:none; padding:12px; background:rgba(0,0,0,.7); border-radius:8px; margin-bottom:8px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
              <strong style="color:#a0e7ff">Achievements</strong>
              <button id="closeAch" class="secondary">Close</button>
            </div>
            <div id="achList" style="display:flex; flex-direction:column; gap:6px;"></div>
          </div>
          <div id="galleryPanel" style="display:none; padding:12px; background:rgba(0,0,0,.7); border-radius:8px; margin-bottom:8px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
              <strong style="color:#a0e7ff">Gallery</strong>
              <button id="closeGallery" class="secondary">Close</button>
            </div>
            <div id="galleryGrid" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap:8px;"></div>
          </div>
          <div id="codexPanel" style="display:none; padding:12px; background:rgba(0,0,0,.7); border-radius:8px; margin-bottom:8px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
              <strong style="color:#a0e7ff">Codex</strong>
              <button id="closeCodex" class="secondary">Close</button>
            </div>
            <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px; flex-wrap:wrap">
              <input id="codexSearch" placeholder="Search..." style="flex:1; min-width:220px; padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff" />
              <select id="codexCategory" style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff">
                <option value="">All Categories</option>
              </select>
            </div>
            <div id="codexFilters" style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:8px"></div>
            <div id="codexList" style="display:flex; flex-direction:column; gap:6px;"></div>
            <div id="codexDetail" style="display:none; margin-top:8px; padding:10px; background:#0b1020; border:1px solid #27304a; border-radius:8px;">
              <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px;">
                <strong id="codexDetailTitle" style="color:#a0e7ff">Title</strong>
                <div style="display:flex; gap:8px; align-items:center;">
                  <button id="codexPinBtn" class="secondary" title="Pin/unpin">Pin</button>
                  <button id="codexFavBtn" class="secondary" title="Favorite/unfavorite">Favorite</button>
                  <button id="codexDetailClose" class="secondary">Close</button>
                </div>
              </div>
              <div id="codexDetailBody" style="color:#a8b0ff; font-size:13px; white-space:pre-wrap"></div>
            </div>
          </div>
          <div id="backlogPanel" style="display:none; padding:12px; background:rgba(0,0,0,.7); border-radius:8px; margin-bottom:8px; max-height:240px; overflow:auto;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
              <strong style="color:#a0e7ff">Backlog</strong>
              <button id="closeBacklog" class="secondary">Close</button>
            </div>
            <div id="backlogList" style="display:flex; flex-direction:column; gap:6px;"></div>
          </div>
          <div id="settingsPanel" style="display:none; padding:12px; background:rgba(0,0,0,.7); border-radius:8px; margin-bottom:8px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
              <strong style="color:#a0e7ff" id="settingsTitle">Settings</strong>
              <button id="closeSettings" class="secondary">Close</button>
            </div>
            <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap">
              <button id="toggleSkipSeen" class="secondary">Skip Seen Text: Off</button>
              <button id="toggleSkipTransitions" class="secondary">Skip Transitions: Off</button>
              <button id="toggleDebugToasts" class="secondary">Debug Toasts: Off</button>
              <button id="toggleHotkeys" class="secondary">Hotkeys: On</button>
              <button id="toggleDebugHud" class="secondary">Debug HUD: Off</button>
              <button id="clearSeen" class="secondary">Clear Seen</button>
              <span style="font-size:12px; color:#a8b0ff">Skips dialogue lines you have already seen.</span>
            </div>
            <div style="margin-top:8px; display:flex; gap:12px; align-items:center; flex-wrap:wrap">
              <div style="display:flex; gap:6px; align-items:center">
                <label for="bgFadeMs" style="font-size:12px; color:#a8b0ff">BG Fade</label>
                <input id="bgFadeMs" type="range" min="0" max="1500" step="50" value="400" style="width:160px; accent-color:#3e59ff" />
                <span id="bgFadeMsVal" style="font-size:12px; color:#a8b0ff">400ms</span>
              </div>
              <div style="display:flex; gap:6px; align-items:center">
                <label for="spriteFadeMs" style="font-size:12px; color:#a8b0ff">Sprite Fade</label>
                <input id="spriteFadeMs" type="range" min="0" max="1500" step="50" value="220" style="width:160px; accent-color:#3e59ff" />
                <span id="spriteFadeMsVal" style="font-size:12px; color:#a8b0ff">220ms</span>
              </div>
            </div>
            <div style="margin-top:8px; display:flex; gap:8px; align-items:center; flex-wrap:wrap">
              <strong style="color:#a0e7ff; font-size:12px" id="langLabel">Language</strong>
              <button id="langEn" class="secondary">English</button>
              <button id="langEs" class="secondary">Spanish</button>
            </div>
          </div>
          <div id="line"><span id="name"></span><span id="text"></span></div>
          <div id="choices"></div>
          <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap">
            <button id="continueBtn">Continue</button>
            <button id="startExample">Start Example</button>
            <button id="startExpressions">Start Expressions</button>
    <button id="startAch">Start Achievements</button>
            <button id="autoBtn" class="secondary">Auto: Off</button>
            <button id="autoChooseBtn" class="secondary">Auto-Choose: Off</button>
            <button id="skipFx" class="secondary">Skip FX: Off</button>
            <button id="openGallery" class="secondary">Gallery</button>
            <button id="openAch" class="secondary">Achievements</button>
            <button id="openCodex" class="secondary">Codex</button>
            <button id="openSettings" class="secondary">Settings</button>
            <button id="openBacklog" class="secondary">Backlog</button>
            <button id="openSaves" class="secondary">Saves</button>
            <button id="openShortcuts" class="secondary">Shortcuts (?)</button>
            <button id="nextBtn" class="secondary">Next</button>
            <button id="saveBtn">Quick Save</button>
            <button id="loadBtn" class="secondary">Quick Load</button>
            <span id="saveStatus" style="font-size:12px; color:#a8b0ff"></span>
          </div>
          <div id="shortcutHint" style="margin-top:6px; font-size:12px; color:#a8b0ff; opacity:.85">
            Tip: Press <strong>?</strong> for shortcuts â€” Space/Enter: Next, A: Auto, Ctrl+S: Save
          </div>
          <div style="margin-top:8px; display:flex; gap:8px; align-items:center; flex-wrap:wrap">
            <strong style="color:#a0e7ff; font-size:12px">Music:</strong>
            <button class="secondary" id="musicPlay">Play</button>
            <button class="secondary" id="musicPause">Pause</button>
            <span id="musicStatus" style="font-size:12px; color:#a8b0ff"></span>
            <input id="volumeSlider" type="range" min="0" max="100" step="1" value="80" title="Volume" style="width:140px; accent-color:#3e59ff" />
            <button class="secondary" id="muteToggle" title="Mute/unmute">Mute</button>
          </div>
          <div style="margin-top:8px; display:flex; gap:8px; align-items:center; flex-wrap:wrap">
            <strong style="color:#a0e7ff; font-size:12px">Slots:</strong>
            <button class="secondary" id="slot1save">Save 1</button>
            <button class="secondary" id="slot1load">Load 1</button>
            <img id="slot1thumb" alt="" style="width:96px; height:54px; object-fit:cover; border-radius:4px; border:1px solid #27304a" />
            <button class="secondary" id="slot2save">Save 2</button>
            <button class="secondary" id="slot2load">Load 2</button>
            <img id="slot2thumb" alt="" style="width:96px; height:54px; object-fit:cover; border-radius:4px; border:1px solid #27304a" />
            <button class="secondary" id="slot3save">Save 3</button>
            <button class="secondary" id="slot3load">Load 3</button>
            <img id="slot3thumb" alt="" style="width:96px; height:54px; object-fit:cover; border-radius:4px; border:1px solid #27304a" />
            <span id="slotStatus" style="font-size:12px; color:#a8b0ff"></span>
          </div>
          <div id="assetPanel" style="margin-top:8px; padding:12px; background:rgba(0,0,0,.65); border:1px dashed #27304a; border-radius:8px;">
            <div style="display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap;">
              <strong style="color:#a0e7ff; font-size:13px">Drag & Drop Assets (non-coder helper)</strong>
              <button id="assetPick" class="secondary">Pick Files</button>
            </div>
            <div id="assetDrop" style="margin-top:6px; padding:10px; border:1px dashed #27304a; border-radius:8px; color:#a8b0ff; font-size:12px; text-align:center; background:#0b1020;">
              Drop images/audio here to preview. Object URLs stay local to your browser.
            </div>
            <div id="assetList" style="margin-top:8px; display:flex; flex-direction:column; gap:6px;"></div>
          </div>
          <div id="sceneLoader" style="margin-top:8px; padding:12px; background:rgba(0,0,0,.65); border-radius:8px; border:1px solid #27304a;">
            <div style="display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap;">
              <strong style="color:#a0e7ff; font-size:13px">Load Custom Scenes (paste JSON)</strong>
              <input id="customStartId" placeholder="Start scene id (optional)" style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff; min-width:160px" />
              <button id="customFileBtn" class="secondary">Pick JSON</button>
              <button id="customLoadBtn">Run</button>
            </div>
            <textarea id="customJson" style="margin-top:6px; width:100%; min-height:140px; background:#0b1020; color:#a8b0ff; border:1px solid #27304a; border-radius:8px; padding:8px; font-family:monospace; font-size:12px;"></textarea>
            <div id="customErrors" style="margin-top:6px; color:#a0e7ff; font-size:12px; white-space:pre-wrap"></div>
          </div>
          <div id="sceneEditor" style="margin-top:8px; padding:12px; background:rgba(0,0,0,.65); border-radius:8px; border:1px solid #27304a;">
            <div style="display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap;">
              <strong style="color:#a0e7ff; font-size:13px">Lightweight Scene Editor</strong>
              <input id="editorSceneId" placeholder="scene id" style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff; min-width:120px" />
              <input id="editorBg" placeholder="background (optional)" style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff; min-width:140px" />
              <input id="editorMusic" placeholder="music (optional)" style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff; min-width:140px" />
              <input id="editorSceneRoles" placeholder='roles (JSON e.g. {"guide":"spr_guide"})' style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff; min-width:200px" />
              <input id="editorBundleIds" placeholder="bundle (comma ids)" style="padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff; min-width:180px" />
              <div id="editorTabs" style="display:flex; gap:6px; flex-wrap:wrap;"></div>
              <button id="editorNewScene" class="secondary">+ Scene</button>
            </div>
            <div style="margin-top:8px; display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:8px; align-items:flex-start;">
              <div>
                <label style="color:#a8b0ff; font-size:12px">Step Type</label>
                <select id="editorStepType" style="width:100%; padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff">
                  <option value="dialogue">dialogue</option>
                  <option value="choice">choice</option>
                  <option value="background">background</option>
                  <option value="spriteShow">spriteShow</option>
                  <option value="spriteSwap">spriteSwap</option>
                  <option value="music">music</option>
                  <option value="flag">flag</option>
                  <option value="transition">transition</option>
                </select>
              </div>
              <div>
                <label style="color:#a8b0ff; font-size:12px">Char / Sprite / Flag</label>
                <input id="editorChar" placeholder="char or sprite id / flag key" style="width:100%; padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff" />
              </div>
              <div>
                <label style="color:#a8b0ff; font-size:12px">Text / Src / Track</label>
                <input id="editorText" placeholder="dialogue text, sprite src, audio track" style="width:100%; padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff" />
              </div>
              <div>
                <label style="color:#a8b0ff; font-size:12px">Move (x,y,ms,ease)</label>
                <input id="editorMove" placeholder="e.g. x=40,y=-10,ms=400" style="width:100%; padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff" />
              </div>
              <div>
                <label style="color:#a8b0ff; font-size:12px">Choice options (label|goto per line)</label>
                <textarea id="editorOptions" style="width:100%; min-height:80px; padding:6px 8px; border-radius:6px; border:1px solid #27304a; background:#0b1020; color:#a8b0ff; font-size:12px"></textarea>
              </div>
            </div>
            <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap;">
              <button id="editorAddStep" class="secondary">Add Step</button>
              <button id="editorReset" class="secondary">Reset</button>
              <button id="editorLoad" class="">Build & Run</button>
              <button id="editorDownload" class="secondary">Download JSON</button>
              <button id="editorImport" class="secondary">Import JSON</button>
            </div>
            <div id="editorSteps" style="margin-top:8px; display:flex; flex-direction:column; gap:6px; color:#a8b0ff; font-size:12px;"></div>
            <pre id="editorPreview" style="margin-top:8px; background:#0b1020; color:#a0e7ff; border:1px solid #27304a; border-radius:8px; padding:8px; font-size:12px; max-height:180px; overflow:auto;"></pre>
            <div id="editorErrors" style="margin-top:6px; color:#ffb4b4; font-size:12px; white-space:pre-wrap"></div>
          </div>
          <div id="savesPanel" style="display:none; padding:12px; background:rgba(0,0,0,.7); border-radius:8px; margin:12px 0;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
              <strong style="color:#a0e7ff">Saves</strong>
              <button id="closeSaves" class="secondary">Close</button>
            </div>
            <div id="savesList" style="display:flex; flex-direction:column; gap:8px;"></div>
          </div>
        </div>
        <!-- First-run onboarding modal -->
        <div id="onboarding" style="display:none; position:absolute; inset:0; z-index:7; display:none; align-items:center; justify-content:center;">
          <div style="max-width:560px; width:92%; background:#0b1020; border:1px solid #27304a; border-radius:10px; padding:14px; color:#a8b0ff; box-shadow:0 20px 40px rgba(0,0,0,.6)">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
              <strong style="color:#a0e7ff">Welcome to Aurora Minimal</strong>
              <button id="onbDismiss" class="secondary">Close</button>
            </div>
            <div style="font-size:13px; margin-bottom:10px; line-height:1.5">
              Get started quickly:
              <ul style="margin:6px 0 0 16px; padding:0">
                <li>Press <strong>Start Example</strong> to load a sample scene.</li>
                <li>Press <strong>?</strong> or <strong>Shortcuts</strong> to see hotkeys.</li>
                <li>Tap/click the scene to advance; use choices to branch.</li>
              </ul>
            </div>
            <div style="display:flex; gap:8px; flex-wrap:wrap">
              <button id="onbStart" class="secondary">Start Example</button>
              <button id="onbShortcuts" class="secondary">Shortcuts</button>
              <button id="onbSettings" class="secondary">Settings</button>
            </div>
          </div>
        </div>
      </div>
      <div id="notifications" aria-live="polite"></div>
    </div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
